<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DMDç½‘ç«™è¯Šæ–­å·¥å…·</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif; 
            margin: 0; 
            padding: 20px; 
            line-height: 1.6; 
            background: #f5f5f5;
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 { color: #6B4C93; text-align: center; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .section h2 { margin-top: 0; color: #333; }
        .success { color: green; }
        .error { color: red; }
        .warning { color: orange; }
        .info { color: blue; }
        pre { background: #f8f8f8; padding: 10px; border-radius: 5px; overflow-x: auto; }
        .test-btn { 
            background: #6B4C93; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 5px; 
            cursor: pointer; 
            margin: 5px;
        }
        .test-btn:hover { background: #5a3f7a; }
        .back-link { 
            display: inline-block; 
            margin-bottom: 20px; 
            color: #6B4C93; 
            text-decoration: none;
        }
        .back-link:hover { text-decoration: underline; }
        .loading { opacity: 0.6; }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">â† è¿”å›ä¸»é¡µ</a>
        
        <h1>DMDç½‘ç«™è¯Šæ–­å·¥å…·</h1>
        <p style="text-align: center; color: #666;">
            æ­¤é¡µé¢ç”¨äºè¯Šæ–­ç½‘ç«™åœ¨ä¸åŒç¯å¢ƒä¸‹çš„å…¼å®¹æ€§é—®é¢˜
        </p>
        
        <!-- åŸºç¡€ç¯å¢ƒä¿¡æ¯ -->
        <div class="section">
            <h2>ğŸ” ç¯å¢ƒä¿¡æ¯</h2>
            <div id="env-info">æ­£åœ¨æ£€æµ‹...</div>
        </div>
        
        <!-- å¤–éƒ¨èµ„æºæµ‹è¯• -->
        <div class="section">
            <h2>ğŸŒ å¤–éƒ¨èµ„æºè®¿é—®æµ‹è¯•</h2>
            <button class="test-btn" onclick="testExternalResources()">å¼€å§‹æµ‹è¯•</button>
            <div id="resource-test">ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•å¤–éƒ¨èµ„æºåŠ è½½æƒ…å†µ</div>
        </div>
        
        <!-- ç½‘ç»œçŠ¶æ€ -->
        <div class="section">
            <h2>ğŸ“¡ ç½‘ç»œçŠ¶æ€</h2>
            <div id="network-info">æ­£åœ¨æ£€æµ‹...</div>
        </div>
        
        <!-- JavaScriptåŠŸèƒ½æµ‹è¯• -->
        <div class="section">
            <h2>âš™ï¸ JavaScriptåŠŸèƒ½æµ‹è¯•</h2>
            <button class="test-btn" onclick="testJSFeatures()">æµ‹è¯•JSåŠŸèƒ½</button>
            <div id="js-test">ç‚¹å‡»æŒ‰é’®æµ‹è¯•JavaScriptå…¼å®¹æ€§</div>
        </div>
        
        <!-- é”™è¯¯æ—¥å¿— -->
        <div class="section">
            <h2>ğŸ“‹ é”™è¯¯æ—¥å¿—</h2>
            <pre id="error-log">æš‚æ— é”™è¯¯è®°å½•</pre>
        </div>
        
        <!-- è¯Šæ–­ç»“æœ -->
        <div class="section">
            <h2>ğŸ“Š è¯Šæ–­ç»“æœ</h2>
            <div id="diagnosis">æ­£åœ¨åˆ†æ...</div>
        </div>
    </div>

    <script>
        // é”™è¯¯æ”¶é›†
        const errors = [];
        window.addEventListener('error', function(e) {
            const error = {
                message: e.message,
                filename: e.filename,
                lineno: e.lineno,
                timestamp: new Date().toLocaleString()
            };
            errors.push(error);
            updateErrorLog();
        });

        // æ›´æ–°é”™è¯¯æ—¥å¿—
        function updateErrorLog() {
            const log = document.getElementById('error-log');
            if (errors.length === 0) {
                log.textContent = 'æš‚æ— é”™è¯¯è®°å½• âœ…';
            } else {
                log.textContent = errors.map(e => 
                    `[${e.timestamp}] ${e.message} (${e.filename}:${e.lineno})`
                ).join('\n');
            }
        }

        // æ£€æµ‹ç¯å¢ƒä¿¡æ¯
        function detectEnvironment() {
            const info = document.getElementById('env-info');
            const userAgent = navigator.userAgent;
            
            const isWeixin = /micromessenger/i.test(userAgent);
            const isAndroid = /android/i.test(userAgent);
            const isIOS = /iphone|ipad|ipod/i.test(userAgent);
            const isMobile = /mobile/i.test(userAgent);
            
            let weixinVersion = '';
            if (isWeixin) {
                const match = userAgent.match(/micromessenger\/(\d+\.\d+\.\d+)/i);
                weixinVersion = match ? match[1] : 'æœªçŸ¥';
            }
            
            info.innerHTML = `
                <p><strong>å½“å‰æ—¶é—´:</strong> ${new Date().toLocaleString()}</p>
                <p><strong>ç”¨æˆ·ä»£ç†:</strong> <code>${userAgent}</code></p>
                <p><strong>æ˜¯å¦å¾®ä¿¡:</strong> <span class="${isWeixin ? 'warning' : 'info'}">${isWeixin ? `æ˜¯ (v${weixinVersion})` : 'å¦'}</span></p>
                <p><strong>æ“ä½œç³»ç»Ÿ:</strong> <span class="info">${isAndroid ? 'Android' : isIOS ? 'iOS' : 'å…¶ä»–'}</span></p>
                <p><strong>è®¾å¤‡ç±»å‹:</strong> <span class="info">${isMobile ? 'ç§»åŠ¨è®¾å¤‡' : 'æ¡Œé¢è®¾å¤‡'}</span></p>
                <p><strong>å±å¹•å°ºå¯¸:</strong> ${window.screen.width} Ã— ${window.screen.height}</p>
                <p><strong>è§†çª—å°ºå¯¸:</strong> ${window.innerWidth} Ã— ${window.innerHeight}</p>
                <p><strong>åœ¨çº¿çŠ¶æ€:</strong> <span class="${navigator.onLine ? 'success' : 'error'}">${navigator.onLine ? 'åœ¨çº¿' : 'ç¦»çº¿'}</span></p>
            `;
        }

        // æµ‹è¯•å¤–éƒ¨èµ„æº
        function testExternalResources() {
            const testDiv = document.getElementById('resource-test');
            testDiv.innerHTML = '<p class="loading">æ­£åœ¨æµ‹è¯•å¤–éƒ¨èµ„æº...</p>';
            
            const resources = [
                {
                    name: 'Google Fonts',
                    url: 'https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap',
                    type: 'css'
                },
                {
                    name: 'Font Awesome',
                    url: 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css',
                    type: 'css'
                },
                {
                    name: 'Google Analytics',
                    url: 'https://www.googletagmanager.com/gtag/js?id=G-VRZ3B14HZ6',
                    type: 'js'
                }
            ];
            
            let results = [];
            let completed = 0;
            
            resources.forEach(resource => {
                const element = resource.type === 'css' ? 
                    document.createElement('link') : 
                    document.createElement('script');
                
                if (resource.type === 'css') {
                    element.rel = 'stylesheet';
                    element.href = resource.url;
                } else {
                    element.src = resource.url;
                }
                
                const startTime = Date.now();
                
                element.onload = () => {
                    const loadTime = Date.now() - startTime;
                    results.push(`<p class="success">âœ… ${resource.name}: åŠ è½½æˆåŠŸ (${loadTime}ms)</p>`);
                    checkComplete();
                };
                
                element.onerror = () => {
                    const loadTime = Date.now() - startTime;
                    results.push(`<p class="error">âŒ ${resource.name}: åŠ è½½å¤±è´¥ (${loadTime}ms)</p>`);
                    checkComplete();
                };
                
                setTimeout(() => {
                    if (!element.onload.called && !element.onerror.called) {
                        results.push(`<p class="warning">â±ï¸ ${resource.name}: åŠ è½½è¶…æ—¶ (10s)</p>`);
                        checkComplete();
                    }
                }, 10000);
                
                document.head.appendChild(element);
            });
            
            function checkComplete() {
                completed++;
                if (completed >= resources.length) {
                    testDiv.innerHTML = results.join('');
                    generateDiagnosis();
                }
            }
        }

        // æµ‹è¯•JavaScriptåŠŸèƒ½
        function testJSFeatures() {
            const testDiv = document.getElementById('js-test');
            const tests = [];
            
            // ES6 ç®­å¤´å‡½æ•°
            try {
                const arrow = () => 'ES6æ”¯æŒ';
                tests.push(`<p class="success">âœ… ES6ç®­å¤´å‡½æ•°: ${arrow()}</p>`);
            } catch (e) {
                tests.push(`<p class="error">âŒ ES6ç®­å¤´å‡½æ•°: ä¸æ”¯æŒ</p>`);
            }
            
            // Promise
            tests.push(`<p class="${typeof Promise !== 'undefined' ? 'success' : 'error'}">
                ${typeof Promise !== 'undefined' ? 'âœ…' : 'âŒ'} Promise: ${typeof Promise !== 'undefined' ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ'}
            </p>`);
            
            // Fetch API
            tests.push(`<p class="${typeof fetch !== 'undefined' ? 'success' : 'error'}">
                ${typeof fetch !== 'undefined' ? 'âœ…' : 'âŒ'} Fetch API: ${typeof fetch !== 'undefined' ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ'}
            </p>`);
            
            // IntersectionObserver
            tests.push(`<p class="${'IntersectionObserver' in window ? 'success' : 'warning'}">
                ${'IntersectionObserver' in window ? 'âœ…' : 'âš ï¸'} IntersectionObserver: ${'IntersectionObserver' in window ? 'æ”¯æŒ' : 'ä¸æ”¯æŒï¼ˆå·²æœ‰polyfillï¼‰'}
            </p>`);
            
            // requestAnimationFrame
            tests.push(`<p class="${'requestAnimationFrame' in window ? 'success' : 'warning'}">
                ${'requestAnimationFrame' in window ? 'âœ…' : 'âš ï¸'} requestAnimationFrame: ${'requestAnimationFrame' in window ? 'æ”¯æŒ' : 'ä¸æ”¯æŒï¼ˆå·²æœ‰polyfillï¼‰'}
            </p>`);
            
            // CSS Grid
            const supportsGrid = CSS.supports('display', 'grid');
            tests.push(`<p class="${supportsGrid ? 'success' : 'warning'}">
                ${supportsGrid ? 'âœ…' : 'âš ï¸'} CSS Grid: ${supportsGrid ? 'æ”¯æŒ' : 'ä¸æ”¯æŒï¼ˆä½¿ç”¨flexboxé™çº§ï¼‰'}
            </p>`);
            
            testDiv.innerHTML = tests.join('');
        }

        // æ£€æµ‹ç½‘ç»œçŠ¶æ€
        function checkNetworkStatus() {
            const info = document.getElementById('network-info');
            const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
            
            let networkInfo = `<p><strong>åœ¨çº¿çŠ¶æ€:</strong> <span class="${navigator.onLine ? 'success' : 'error'}">${navigator.onLine ? 'åœ¨çº¿' : 'ç¦»çº¿'}</span></p>`;
            
            if (connection) {
                networkInfo += `
                    <p><strong>è¿æ¥ç±»å‹:</strong> ${connection.effectiveType || 'æœªçŸ¥'}</p>
                    <p><strong>ä¸‹è¡Œé€Ÿåº¦:</strong> ${connection.downlink ? connection.downlink + ' Mbps' : 'æœªçŸ¥'}</p>
                    <p><strong>å»¶è¿Ÿ:</strong> ${connection.rtt ? connection.rtt + ' ms' : 'æœªçŸ¥'}</p>
                `;
            } else {
                networkInfo += `<p class="warning">âš ï¸ æ— æ³•è·å–è¯¦ç»†ç½‘ç»œä¿¡æ¯</p>`;
            }
            
            info.innerHTML = networkInfo;
        }

        // ç”Ÿæˆè¯Šæ–­ç»“æœ
        function generateDiagnosis() {
            const diagnosis = document.getElementById('diagnosis');
            const userAgent = navigator.userAgent;
            const isWeixin = /micromessenger/i.test(userAgent);
            const isAndroid = /android/i.test(userAgent);
            
            let result = '<h3>è¯Šæ–­ç»“æœ:</h3>';
            
            if (isWeixin && isAndroid) {
                result += `
                    <div class="warning">
                        <p><strong>âš ï¸ æ£€æµ‹åˆ°Androidå¾®ä¿¡ç¯å¢ƒ</strong></p>
                        <p>è¿™æ˜¯æœ€å®¹æ˜“å‡ºç°å…¼å®¹æ€§é—®é¢˜çš„ç¯å¢ƒç»„åˆã€‚</p>
                    </div>
                `;
            }
            
            if (errors.length > 0) {
                result += `
                    <div class="error">
                        <p><strong>âŒ å‘ç°JavaScripté”™è¯¯</strong></p>
                        <p>é¡µé¢å­˜åœ¨${errors.length}ä¸ªé”™è¯¯ï¼Œå¯èƒ½å½±å“æ­£å¸¸ä½¿ç”¨ã€‚</p>
                    </div>
                `;
            } else {
                result += `
                    <div class="success">
                        <p><strong>âœ… JavaScriptè¿è¡Œæ­£å¸¸</strong></p>
                        <p>æ²¡æœ‰å‘ç°æ˜æ˜¾çš„JavaScripté”™è¯¯ã€‚</p>
                    </div>
                `;
            }
            
            result += `
                <h4>å»ºè®®:</h4>
                <ul>
                    <li>å¦‚æœå¤–éƒ¨èµ„æºåŠ è½½å¤±è´¥ï¼Œå»ºè®®ä½¿ç”¨å·²ä¼˜åŒ–çš„æ— ä¾èµ–ç‰ˆæœ¬</li>
                    <li>å¦‚æœä»æœ‰é—®é¢˜ï¼Œè¯·æˆªå›¾æ­¤é¡µé¢å†…å®¹å¹¶åé¦ˆç»™ç®¡ç†å‘˜</li>
                    <li>å¯ä»¥å°è¯•æ¸…é™¤å¾®ä¿¡ç¼“å­˜åé‡æ–°è®¿é—®</li>
                    <li>å»ºè®®åœ¨ä¸åŒç½‘ç»œç¯å¢ƒä¸‹æµ‹è¯•ï¼ˆWiFi vs ç§»åŠ¨ç½‘ç»œï¼‰</li>
                </ul>
            `;
            
            diagnosis.innerHTML = result;
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
        window.addEventListener('load', function() {
            detectEnvironment();
            checkNetworkStatus();
            
            // ç›‘å¬ç½‘ç»œçŠ¶æ€å˜åŒ–
            window.addEventListener('online', () => {
                checkNetworkStatus();
                document.body.insertAdjacentHTML('afterbegin', 
                    '<div style="background:green;color:white;padding:10px;text-align:center;">ç½‘ç»œå·²è¿æ¥</div>'
                );
            });
            
            window.addEventListener('offline', () => {
                checkNetworkStatus();
                document.body.insertAdjacentHTML('afterbegin', 
                    '<div style="background:red;color:white;padding:10px;text-align:center;">ç½‘ç»œå·²æ–­å¼€</div>'
                );
            });
        });
    </script>
</body>
</html>